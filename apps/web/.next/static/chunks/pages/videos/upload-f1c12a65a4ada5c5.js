(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99],{4011:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/videos/upload",function(){return t(7835)}])},7835:function(e,s,t){"use strict";t.r(s);var a=t(2322),r=t(2382),o=t(5632),n=t(2784),i=t(2202),l=t(3476),c=t(4330),u=t(509),d=t(5546),p=t(3542);s.default=(0,u.Z)(()=>{let e=(0,n.useRef)(null),s=(0,n.useRef)(null),t=(0,l.Zl)(c.Lz),u=(0,l.Zl)(c.K3),h=(0,o.useRouter)(),{BASEURL:g,AWS_RAW_VIDEO_BUCKET_NAME:m}=p.env,f=async a=>{let o=e.current;if(o){let e=new Date().toISOString().replace(/[-:.]/g,""),n="".concat(a.videoKey,"-").concat(e);a.videoKey=n,(0,r.Z)({baseURL:g||"http://localhost:3000/api",url:"/video/getPutSignedUrl",method:"GET",headers:{"Content-Type":"application/json",Authorization:sessionStorage.getItem("creatorToken"),key:n,bucketname:a.bucketName}}).then(e=>{200==e.status&&(0,r.Z)({url:e.data.presignedUrl,method:"PUT",data:o.files[0],headers:{"Content-Type":o.type}}).then(e=>{200==e.status&&(0,r.Z)({baseURL:g||"http://localhost:3000/api",url:"/video/add".concat(s.current.value.charAt(0).toUpperCase()+s.current.value.slice(1),"Credential"),method:"POST",data:a,headers:{"Content-Type":"application/json",Authorization:sessionStorage.getItem("creatorToken")}}).then(e=>{200==e.status&&("raw"==s.current.value?t(s=>[...s,{...a,_id:e.data._id,creator:e.data.creator,editor:e.data.editor,isUploaded:!1,isEdited:!1,url:e.data.url}]):"edit"==s.current.value&&u(s=>[...s,{...a,_id:e.data._id,creator:e.data.creator,editor:e.data.editor,isUploaded:!1,isEdited:!0,url:e.data.url}]),i.Am.success(e.data.message),h.push("/videos/raw"))}).catch(e=>{e?e.response&&403==e.response.status?(i.Am.error(e.response.data.message),sessionStorage.clear(),h.push("/login")):401==e.response.status&&(i.Am.error("Please first allow us your youtube access"),h.push("/auth")):e.response&&i.Am.error(e.response.data.message),console.log(e)})}).catch(e=>{e?e.response&&(403==e.response.status||401==e.response.status)&&(i.Am.error(e.response.data.message),sessionStorage.clear(),h.push("/login")):e.response&&i.Am.error(e.response.data.message),console.log(e)})}).catch(e=>{e?e.response&&(403==e.response.status||401==e.response.status)&&(i.Am.error(e.response.data.message),sessionStorage.clear(),h.push("/login")):e.response&&i.Am.error(e.response.data.message),console.log(e)})}else console.warn("No video selected for upload.")};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"h-screen bg-gray-100 flex justify-center items-center",children:(0,a.jsx)(d.kj,{propData:f,type:s,fileRef:e,client:"creator"})})})})},509:function(e,s,t){"use strict";var a=t(2322),r=t(2382),o=t(5632),n=t(2784),i=t(2202),l=t(3542);s.Z=e=>s=>{let t=(0,o.useRouter)(),{BASEURL:c}=l.env,u=async()=>{(0,r.Z)({baseURL:c||"http://localhost:3000/api",url:"/auth/me",method:"GET",headers:{"Content-Type":"application/json",Authorization:sessionStorage.getItem("creatorToken")}}).then(e=>{e.data.isValid||(i.Am.error(e.data.message),sessionStorage.clear(),t.push("/login"))}).catch(e=>{e&&!e.response.isValid&&(i.Am.error(e.response.data.message),sessionStorage.clear(),t.push("/login"))})};return(0,n.useEffect)(()=>{sessionStorage.getItem("creatorToken")&&0!=sessionStorage.getItem("creatorToken").length?u():(sessionStorage.clear(),t.push("/login"))},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(e,{...s})})}}},function(e){e.O(0,[382,774,888,179],function(){return e(e.s=4011)}),_N_E=e.O()}]);